<div class="container">


</div>

<!-- Displaying order items & corresponding service items -->

<div class="admin-container">

  <div class="col-xs-12 col-sm-6 col-md-6">
    <div class="card dashboard-big-tasks-card">
      <h4><strong>Filters</strong></h4>
      <br>
        <%= form_tag admin_orders_path, method: :get do %>
        <%= label_tag :service %>
        <%= select_tag "service", options_from_collection_for_select(Service.all, "id", "name"), prompt: "Filter by  service" %>
        <!-- Filter by service -->
        <%= label_tag :status %>
        <%= select_tag "status", options_for_select([ "Completed", "Pending" ], "Filter by status") %>
        <!-- Filter by status -->
        <br>
        <%= submit_tag "filter", class: "btn btn-large btn-primary" %>
        <% end %>
        <!-- Display metrics -->
        <br>
        <br>
      <% tasks = Array.new %>
      <% mail_tasks = Array.new %>
      <% clearance_tasks = Array.new %>
      <% contract_tasks = Array.new %>
      <% @order_items.each do |order_item| %>
        <% if order_item.completed == false && order_item.service_item.category == "task" %>
          <% tasks << order_item %>
            <% if order_item.service_item.service.name == "Mail Forwarding" %>
              <% mail_tasks << order_item %>
            <% elsif order_item.service_item.service.name == "House Clearance" %>
              <% mail_tasks << order_item %>
            <% elsif order_item.service_item.service.name == "Contract Cancellation" %>
              <% contract_tasks << order_item %>
            <% end %>
        <% end %>
      <% end %>

      <h4><strong><%= tasks.count %></strong></h4>
      <p> Pending tasks</p>
      <br>

      <h4><strong><%= clearance_tasks.count %></strong></h4>
      <p> House clearance</p>
      <br>

      <h4><strong><%= mail_tasks.count %><strong></h4>
      <p> Mail forwarding</p>
      <br>

      <h4><strong><%= contract_tasks.count %><strong></h4>
      <p> Contract cancellation</p>
    </div>

  </div>

  <div class="cards-container">
    <% @order_items.each do |order_item| %>

        <div class="col-xs-12 col-sm-6 col-md-3">
          <div class="card cards-container">
            <div class="card dashboard-tasks-card">
              <p class ="card-small-title"><strong><%= order_item.service_item.service.name.capitalize %></strong></p>
              <p><img style="height:15px" src="../assets/order_black_icon.png" alt="Service"> Order # <%= order_item.order.id %></p>
              <p><%= order_item.service_item.content.capitalize %> => <%= order_item.content %></p>
              <%= simple_form_for [:admin, order_item] do |f| %>
                <%= f.input :completed, input_html: {value: !order_item.completed }, as: :hidden %>
                <!-- button -->
                <%= button_tag type: 'submit', class: "not-btn" do %>
                  <% if order_item.completed %>
                  <p>Completed</p>
                    <i class="fas fa-toggle-on lg"></i>
                  <% else %>
                    <p>Pending</p>
                    <i class="fas fa-toggle-off lg"></i>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
    <% end %>
  </div>
</div>
